=== ENHANCED PAYMENT SYNC LOG ===
Started at: 2025-08-14T13:52:15.056Z
Processing Square with orders/customers and contacts

âœ“ Supabase client initialized
âœ“ Square provider initialized (REQUIRED)
âœ“ DA-LODGETIX initialized
âœ“ WS-LODGETIX initialized
âœ“ WS-LODGETICKETS initialized

Initialized 4 payment provider(s)

=== STARTING ENHANCED PAYMENT SYNC ===
Processing workflow:
1. Import payment to import_payments (with field transformation)
2. Fetch order/customer for Square payments
3. Find registration in Supabase
4. Update with charge ID for Stripe
5. Import to import_registrations (with field transformation)
6. Import attendees to import_attendees
7. Import tickets to import_tickets
8. Import contacts to import_contacts with deduplication
9. Process booking contact as customer with registration metadata
9. Selective sync to production collections based on field comparison

âœ“ Connected to MongoDB:
  Cluster: LodgeTix-migration-test-1
  Database: lodgetix
  URI: mongodb+srv:****@lodgetix-migration-test.wydwfu6.mongodb.net/lodgetix?retryWrites=true&w=majority&appName=LodgeTix-migration-test-1

â”â”â” Processing Square â”â”â”

Fetching ALL historical Square payments (one at a time)...
  Fetched payment 1 (cursor: none)

ğŸ“ Processing Square payment: p4g7czFGnXbMPrHYOtWSnqCieZLZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 2 (cursor: provided)

ğŸ“ Processing Square payment: JOBqwBmraQ1ECS1fVhtdy55ZrrMZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 3 (cursor: provided)

ğŸ“ Processing Square payment: bHpqGQWwCK6aDNnbhv6ChzltfedZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 4 (cursor: provided)

ğŸ“ Processing Square payment: TFOQEKkW2rQS4WHUBdIjyoSj0EJZY
  ğŸ›’ Fetching order: PmrqVJtirgH1fdESY0p1cy8J9PJZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: A09RKAAZVBGMWKHG63NQ9MWDK4
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: a27ae77c-5e64-463f-a20e-c39febc3b537
  âœ“ Updated import_payments with registrationId: a27ae77c-5e64-463f-a20e-c39febc3b537
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Sydney D Melville
    âœ“ Created new customer: Sydney D Melville
    âœ“ Updated registration with customer ObjectId
    Extracting 2 attendees from registration_data
  âœ“ Found 2 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 5 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: David Melville
    âœ“ Processed contact: Christina Melville
  âœ… Completed processing Square payment TFOQEKkW2rQS4WHUBdIjyoSj0EJZY
  Got cursor for next payment
  Fetched payment 5 (cursor: provided)

ğŸ“ Processing Square payment: ZGvLjl0ZA3MT9vf33jacwBNG5ycZY
  ğŸ›’ Fetching order: dNP0foHRyJX71IcgjllYOP4nal7YY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: PM82SG2V8EXAX1QF1D1ARP1D4G
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: 796c4447-b3f8-404b-8610-322b61f92985
  âœ“ Updated import_payments with registrationId: 796c4447-b3f8-404b-8610-322b61f92985
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: William Jarwin  Sy
    âœ“ Created new customer: William Jarwin  Sy
    âœ“ Updated registration with customer ObjectId
    Extracting 1 attendees from registration_data
  âœ“ Found 1 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 2 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Rodney Benedicto
  âœ… Completed processing Square payment ZGvLjl0ZA3MT9vf33jacwBNG5ycZY
  Got cursor for next payment
  Fetched payment 6 (cursor: provided)

ğŸ“ Processing Square payment: h8gN46mZTfnGV8xDOWY7q4nnsVPZY
  ğŸ›’ Fetching order: ltBcU3AhUBpJNKnwUr1Af6H8qcIZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: M24SZ52MDNDS8EBQQ2QF7SVR2W
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: fa2a849a-1276-444e-bd93-a2303871e5f5
  âœ“ Updated import_payments with registrationId: fa2a849a-1276-444e-bd93-a2303871e5f5
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Scott MAYER
    âœ“ Created new customer: Scott MAYER
    âœ“ Updated registration with customer ObjectId
    Extracting 1 attendees from registration_data
  âœ“ Found 1 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 2 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Scott MAYER
  âœ… Completed processing Square payment h8gN46mZTfnGV8xDOWY7q4nnsVPZY
  Got cursor for next payment
  Fetched payment 7 (cursor: provided)

ğŸ“ Processing Square payment: NQtKfWQJ2pMEfWLqgqbhTOSQVgeZY
  ğŸ›’ Fetching order: 9Twt8vGtP7spniLTAyiXrM3dVvQZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: CNBS19TD5QKYGR9FRVHKDG6HG4
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: f6d6bc9a-465a-4ed3-85ef-4e9b312fea2b
  âœ“ Updated import_payments with registrationId: f6d6bc9a-465a-4ed3-85ef-4e9b312fea2b
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Bob Burbank
    âœ“ Created new customer: Bob Burbank
    âœ“ Updated registration with customer ObjectId
    Extracting 2 attendees from registration_data
  âœ“ Found 2 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 3 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Bob Burbank
    âœ“ Processed contact: Wendy Burbank
  âœ… Completed processing Square payment NQtKfWQJ2pMEfWLqgqbhTOSQVgeZY
  Got cursor for next payment
  Fetched payment 8 (cursor: provided)

ğŸ“ Processing Square payment: 3l9mbrzU72IPMJ1vscl47aM5EzeZY
  ğŸ›’ Fetching order: 9ppiz3e32Y8XhEo3HWVOfMGonuFZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: 2S5AZ8HTW2RETTYVFKW0V4103W
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: d2cfbf4d-1c03-4aa7-84cc-37f7b0ad87d3
  âœ“ Updated import_payments with registrationId: d2cfbf4d-1c03-4aa7-84cc-37f7b0ad87d3
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Greg Hind
    âœ“ Created new customer: Greg Hind
    âœ“ Updated registration with customer ObjectId
    Extracting 1 attendees from registration_data
  âœ“ Found 1 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 2 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Greg Hind
  âœ… Completed processing Square payment 3l9mbrzU72IPMJ1vscl47aM5EzeZY
  Got cursor for next payment
  Fetched payment 9 (cursor: provided)

ğŸ“ Processing Square payment: jfPss6uLfMf6Sy8Z7WtPH9FLERKZY
  ğŸ›’ Fetching order: Rr94kz2q0ynGYLp1cjhpi2stM6bZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: 13D7AHDZPXR0H63P5YK28B0AZ4
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: 19cea4d0-6f5a-489a-abc8-56c4980b37d0
  âœ“ Updated import_payments with registrationId: 19cea4d0-6f5a-489a-abc8-56c4980b37d0
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Romy Nieto
    âœ“ Created new customer: Romy Nieto
    âœ“ Updated registration with customer ObjectId
    Extracting 2 attendees from registration_data
  âœ“ Found 2 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 3 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Romy Nieto
    âœ“ Processed contact: Ellen Nieto
  âœ… Completed processing Square payment jfPss6uLfMf6Sy8Z7WtPH9FLERKZY
  Got cursor for next payment
  Fetched payment 10 (cursor: provided)

ğŸ“ Processing Square payment: VaU4RCrbBAky4Jpe4pvV1GBwRSJZY
  ğŸ›’ Fetching order: XEUaA2VChCDdrTsMfGKOtSze5bJZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: XDWVTVPPYZEPDHVK55TA1YTS7R
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: aaef562e-92c4-4f6e-860c-e9874dec341e
  âœ“ Updated import_payments with registrationId: aaef562e-92c4-4f6e-860c-e9874dec341e
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Juan Carlos Flores
    âœ“ Created new customer: Juan Carlos Flores
    âœ“ Updated registration with customer ObjectId
    Extracting 2 attendees from registration_data
  âœ“ Found 2 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 2 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Juan Carlos  Flores
    âœ“ Processed contact: Elia Babi
  âœ… Completed processing Square payment VaU4RCrbBAky4Jpe4pvV1GBwRSJZY
  Got cursor for next payment
