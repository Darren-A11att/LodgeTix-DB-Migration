=== ENHANCED PAYMENT SYNC LOG ===
Started at: 2025-08-15T06:35:22.019Z
Processing Square with orders/customers and contacts

✓ Supabase client initialized
✓ Square provider initialized (REQUIRED)
✓ DA-LODGETIX initialized
✓ WS-LODGETIX initialized
✓ WS-LODGETICKETS initialized

Initialized 4 payment provider(s)

=== STARTING ENHANCED PAYMENT SYNC ===
Processing workflow:
1. Import payment to import_payments (with field transformation)
2. Fetch order/customer for Square payments
3. Find registration in Supabase
4. Update with charge ID for Stripe
5. Import to import_registrations (with field transformation)
6. Import attendees to import_attendees
7. Import tickets to import_tickets
8. Import contacts to import_contacts with deduplication
9. Process booking contact as customer with registration metadata
9. Selective sync to production collections based on field comparison

✓ Connected to MongoDB:
  Cluster: LodgeTix-migration-test-1
  Database: lodgetix
  URI: mongodb+srv:****@lodgetix-migration-test.wydwfu6.mongodb.net/lodgetix?retryWrites=true&w=majority&appName=LodgeTix-migration-test-1

━━━ Processing Square ━━━

Fetching ALL historical Square payments (one at a time)...
  Fetched payment 1 (cursor: none)

📝 Processing Square payment: jtwvvCSh0dwASWgUW1TAfF2l635YY
  ✅ Importing completed payment - status: COMPLETED
  🛒 Fetching order: 7yaaYVdcdEKNVAONK7yjFOSXI5YZY
    ✓ Order fetched
  👤 Fetching customer: 95DXMSZ5F6T26CNSDZKASYSXVC
    ✓ Customer fetched
  ✓ Imported to import_payments with field transformation
  ✓ Found registration: 1dfc42bb-7fae-4cff-a763-f57934a880e0
  ✓ Updated import_payments with registrationId: 1dfc42bb-7fae-4cff-a763-f57934a880e0
  ✓ Imported FULL registration to import_registrations with field transformation
  ⏸️ Production sync deferred to selective sync phase (eligible for production sync)
  📝 Processing booking contact as customer
    Customer data created: Jonathan Vergara
    ✓ Created new customer: Jonathan Vergara
    ✓ Updated registration with customer ObjectId
    Extracting 2 attendees from registration_data
  ✓ Found 2 attendee(s)
    Extracting 3 tickets from registration_data.selectedTickets
    📝 Using event_ticket_id for eventTicketId: be94ef03-6647-48d5-97ea-f98c862e30e6
    🔍 Looking up eventTicket: be94ef03-6647-48d5-97ea-f98c862e30e6
    ✅ Found eventTicket: Quarterly Communication (price: 0)
    📝 Using event_ticket_id for eventTicketId: 7196514b-d4b8-4fe0-93ac-deb4c205dd09
    🔍 Looking up eventTicket: 7196514b-d4b8-4fe0-93ac-deb4c205dd09
    ✅ Found eventTicket: Grand Proclamation Ceremony (price: 20)
    📝 Using event_ticket_id for eventTicketId: 7196514b-d4b8-4fe0-93ac-deb4c205dd09
    🔍 Looking up eventTicket: 7196514b-d4b8-4fe0-93ac-deb4c205dd09
    ✅ Found eventTicket: Grand Proclamation Ceremony (price: 20)
    📦 Returning 3 processed tickets from registration_data
  ✓ Found 3 ticket(s) in registration
    💾 Saving ticket to import_tickets: import_1dfc42bb-7fae-4cff-a763-f57934a880e0_ticket_0 (Quarterly Communication, qty: 1)
      ✅ Created ticket document
    💾 Saving ticket to import_tickets: import_1dfc42bb-7fae-4cff-a763-f57934a880e0_ticket_1 (Grand Proclamation Ceremony, qty: 1)
      ✅ Created ticket document
    💾 Saving ticket to import_tickets: import_1dfc42bb-7fae-4cff-a763-f57934a880e0_ticket_2 (Grand Proclamation Ceremony, qty: 1)
      ✅ Created ticket document
    ✓ Processed contact: Jonathan Vergara
    ✓ Processed contact: Lyndie Vergara
  ✅ Completed processing Square payment jtwvvCSh0dwASWgUW1TAfF2l635YY (production eligible)
  Got cursor for next payment
  Fetched payment 2 (cursor: provided)

📝 Processing Square payment: 7nHbZYYBn7M1thYdSmgNo9n28yKZY
  ✅ Importing completed payment - status: COMPLETED
  🛒 Fetching order: BdkhqdA7K07dYEot5ELbumhNq5NZY
    ✓ Order fetched
  👤 Fetching customer: MNKR0AM5HCMYB5TAJJ2CJSVWY4
    ✓ Customer fetched
  ✓ Imported to import_payments with field transformation
  ✓ Found registration: e976c5a7-e506-4acf-a718-d893ded67f10
  ✓ Updated import_payments with registrationId: e976c5a7-e506-4acf-a718-d893ded67f10
  ✓ Imported FULL registration to import_registrations with field transformation
  ⏸️ Production sync deferred to selective sync phase (eligible for production sync)
  📝 Processing booking contact as customer
    Customer data created: Abraham Constantin
    ✓ Created new customer: Abraham Constantin
    ✓ Updated registration with customer ObjectId
    Extracting 1 attendees from registration_data
  ✓ Found 1 attendee(s)
    Extracting 1 tickets from registration_data.selectedTickets
    📝 Using event_ticket_id for eventTicketId: be94ef03-6647-48d5-97ea-f98c862e30e6
    🔍 Looking up eventTicket: be94ef03-6647-48d5-97ea-f98c862e30e6
    ✅ Found eventTicket: Quarterly Communication (price: 0)
    📦 Returning 1 processed tickets from registration_data
  ✓ Found 1 ticket(s) in registration
    💾 Saving ticket to import_tickets: import_e976c5a7-e506-4acf-a718-d893ded67f10_ticket_0 (Quarterly Communication, qty: 1)
      ✅ Created ticket document
    ✓ Processed contact: Abraham Constantin
  ✅ Completed processing Square payment 7nHbZYYBn7M1thYdSmgNo9n28yKZY (production eligible)
  Got cursor for next payment
  Fetched payment 3 (cursor: provided)

📝 Processing Square payment: p4g7czFGnXbMPrHYOtWSnqCieZLZY
  ✅ Importing completed payment - status: COMPLETED
  🛒 Fetching order: Ts560QoctAIxc4p53odwFYbARhdZY
    ✓ Order fetched
  👤 Fetching customer: D8VRXK9JQB32E9RDYWMJFW5YJW
    ✓ Customer fetched
  ✓ Imported to import_payments with field transformation
  ✓ Found registration: 385f58c7-9a3b-4b45-9e3c-d461fdc6b19d
  ✓ Updated import_payments with registrationId: 385f58c7-9a3b-4b45-9e3c-d461fdc6b19d
  ✓ Imported FULL registration to import_registrations with field transformation
  ⏸️ Production sync deferred to selective sync phase (eligible for production sync)
  📝 Processing booking contact as customer
    Customer data created: Gregg Summerhayes
    ✓ Created new customer: Gregg Summerhayes
    ✓ Updated registration with customer ObjectId
    Extracting 1 attendees from registration_data
  ✓ Found 1 attendee(s)
    Extracting 3 tickets from registration_data.tickets
    📝 Using event_ticket_id for eventTicketId: d586ecc1-e410-4ef3-a59c-4a53a866bc33
    🔍 Looking up eventTicket: d586ecc1-e410-4ef3-a59c-4a53a866bc33
    ✅ Found eventTicket: Meet & Greet Cocktail Party (price: 70)
    📝 Using event_ticket_id for eventTicketId: be94ef03-6647-48d5-97ea-f98c862e30e6
    🔍 Looking up eventTicket: be94ef03-6647-48d5-97ea-f98c862e30e6
    ✅ Found eventTicket: Quarterly Communication (price: 0)
    📝 Using event_ticket_id for eventTicketId: 7196514b-d4b8-4fe0-93ac-deb4c205dd09
    🔍 Looking up eventTicket: 7196514b-d4b8-4fe0-93ac-deb4c205dd09
    ✅ Found eventTicket: Grand Proclamation Ceremony (price: 20)
    📦 Returning 3 processed tickets from registration_data
  ✓ Found 3 ticket(s) in registration
    💾 Saving ticket to import_tickets: import_385f58c7-9a3b-4b45-9e3c-d461fdc6b19d_ticket_0 (Meet & Greet Cocktail Party, qty: 1)
      ✅ Created ticket document
    💾 Saving ticket to import_tickets: import_385f58c7-9a3b-4b45-9e3c-d461fdc6b19d_ticket_1 (Quarterly Communication, qty: 1)
