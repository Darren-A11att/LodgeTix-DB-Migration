=== ENHANCED PAYMENT SYNC LOG ===
Started at: 2025-08-24T23:13:16.915Z
Processing Square with orders/customers and contacts

✓ Supabase client initialized
✓ Square provider initialized (REQUIRED)
✓ DA-LODGETIX initialized
✓ WS-LODGETIX initialized
✓ WS-LODGETICKETS initialized

Initialized 4 payment provider(s)
✓ Connected to MongoDB:
  Cluster: LodgeTix-migration-test-1
  Database: lodgetix
  URI: mongodb+srv:****@lodgetix-migration-test.wydwfu6.mongodb.net/lodgetix?retryWrites=true&w=majority&appName=LodgeTix-migration-test-1

=== STARTING ENHANCED PAYMENT SYNC ===
Processing workflow:
1. Import payment to import_payments (with field transformation)
2. Fetch order/customer for Square payments
3. Find registration in Supabase
4. Update with charge ID for Stripe
5. Import to import_registrations (with field transformation)
6. Import attendees to import_attendees
7. Import tickets to import_tickets
8. Import contacts to import_contacts with deduplication
9. Process booking contact as customer with registration metadata
9. Selective sync to production collections based on field comparison


━━━ Processing Square ━━━

Fetching Square payments since 2025-08-24T23:12:12.308Z (INCREMENTAL)...
✓ Processed 0 Square payments (total fetched: 0)

━━━ Processing DA-LODGETIX ━━━

Fetching Stripe charges since 2025-08-24T23:12:12.308Z (INCREMENTAL)...

━━━ Processing WS-LODGETIX ━━━

Fetching Stripe charges since 2025-08-24T23:12:12.308Z (INCREMENTAL)...

━━━ Processing WS-LODGETICKETS ━━━

Fetching Stripe charges since 2025-08-24T23:12:12.308Z (INCREMENTAL)...

✅ All payments processed with immediate production sync
   Each payment's complete data chain was synced to production before processing the next payment
   This prevents orphaned tickets and ensures all relationships are properly maintained

🔍 Starting Error Verification...
Checking error documents against test database...


📊 VERIFICATION RESULTS:
Error Payments - Found: 0, Not Found: 12
Error Registrations - Found: 0, Not Found: 0
Orphaned Registrations - Found: 0, Not Found: 0

📈 Overall: 0.00% of error documents exist in test DB
⚠️  Low found rate indicates genuine sync failures
✅ Error verification completed


🛒 Processing Orders from Registrations...
✅ Orders created: 0
⏭️ Orders skipped: 317

📋 Skip Reasons:
   Order already exists for this registration: 317 orders

=== SYNC COMPLETE ===
✅ Processed: 0
⏭️ Skipped: 0
❌ Errors: 0
👥 Unique contacts: 0
📊 Total: 0
