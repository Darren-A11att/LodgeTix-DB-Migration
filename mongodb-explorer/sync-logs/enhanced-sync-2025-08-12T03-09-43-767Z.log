=== ENHANCED PAYMENT SYNC LOG ===
Started at: 2025-08-12T03:09:43.768Z
Processing Square with orders/customers and contacts

✓ Supabase client initialized
✓ Square provider initialized (REQUIRED)
✓ DA-LODGETIX initialized
✓ WS-LODGETIX initialized
✓ WS-LODGETICKETS initialized

Initialized 4 payment provider(s)

=== STARTING ENHANCED PAYMENT SYNC ===
Processing workflow:
1. Import payment to payments_import
2. Fetch order/customer for Square payments
3. Find registration in Supabase
4. Update with charge ID for Stripe
5. Import to registrations_import
6. Link and import to final collections
7. Process attendees and tickets
8. Process contacts with deduplication

✓ Connected to MongoDB database: lodgetix

━━━ Processing Square ━━━

Fetching Square payments (cursor: blank)
Error fetching Square payments: Cannot read properties of undefined (reading 'listPayments')

━━━ Processing DA-LODGETIX ━━━

📝 Processing charge: ch_3RYNqYKBASow5NsW17D1d6gl
  ✓ Imported charge to payments_import
  ✓ Found registration: 222ddcc8-4f1a-4301-9e44-18a89770e1ed
  ✓ Imported to registrations_import with charge ID
  ✓ Imported to final collections
  ✓ Found 1 attendee(s)
    ✓ Processed contact: Darren Allatt
    ✓ Found 0 ticket(s) for attendee undefined
  ✅ Completed processing charge ch_3RYNqYKBASow5NsW17D1d6gl

📝 Processing charge: ch_3RYNH3KBASow5NsW0hd6SVQA
  ⏭️ Skipping - fully refunded
Reached limit of 2 for DA-LODGETIX

━━━ Processing WS-LODGETIX ━━━

📝 Processing charge: ch_3RatsQHDfNBUEWUu0i6JkO6W
  ✓ Imported charge to payments_import
  ✓ Found registration: 8a63ce42-9276-4254-b3cc-406d78cdbb16
  ✓ Imported to registrations_import with charge ID
  ✓ Imported to final collections
  ✓ Found 1 attendee(s)
    ✓ Processed contact: Amitava Sen
    ✓ Found 0 ticket(s) for attendee undefined
  ✅ Completed processing charge ch_3RatsQHDfNBUEWUu0i6JkO6W

📝 Processing charge: ch_3RatmpHDfNBUEWUu0aKhh2Yq
  ✓ Imported charge to payments_import
  ✓ Found registration: a502eec2-4f0b-44aa-b605-a6ec622a546a
  ✓ Imported to registrations_import with charge ID
  ✓ Imported to final collections
  ✓ Found 0 attendee(s)
  ✅ Completed processing charge ch_3RatmpHDfNBUEWUu0aKhh2Yq
Reached limit of 2 for WS-LODGETIX

━━━ Processing WS-LODGETICKETS ━━━

📝 Processing charge: ch_3RbJfOCari1bgsWq0CxPr7NI
  ✓ Imported charge to payments_import
  ✓ Found registration: 533f4153-ab85-4552-a372-2d71fc42e546
  ✓ Imported to registrations_import with charge ID
  ✓ Imported to final collections
  ✓ Found 1 attendee(s)
    ✓ Processed contact: Marcelo III Caguioa
    ✓ Found 0 ticket(s) for attendee undefined
  ✅ Completed processing charge ch_3RbJfOCari1bgsWq0CxPr7NI

📝 Processing charge: ch_3RbGXFCari1bgsWq1HXOJzrX
  ✓ Imported charge to payments_import
  ✓ Found registration: 371a8bae-7c4f-4650-a0d6-085912e5f57c
  ✓ Imported to registrations_import with charge ID
  ✓ Imported to final collections
  ✓ Found 1 attendee(s)
    ✓ Processed contact: Jon Bon Jovi Macaraeg
    ✓ Found 0 ticket(s) for attendee undefined
  ✅ Completed processing charge ch_3RbGXFCari1bgsWq1HXOJzrX
Reached limit of 2 for WS-LODGETICKETS

=== SYNC COMPLETE ===
✅ Processed: 5
⏭️ Skipped: 1
❌ Errors: 1
👥 Unique contacts: 4
📊 Total: 7
