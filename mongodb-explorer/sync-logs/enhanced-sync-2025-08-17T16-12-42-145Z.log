=== ENHANCED PAYMENT SYNC LOG ===
Started at: 2025-08-17T16:12:42.146Z
Processing Square with orders/customers and contacts

âœ“ Supabase client initialized
âœ“ Square provider initialized (REQUIRED)
âœ“ DA-LODGETIX initialized
âœ“ WS-LODGETIX initialized
âœ“ WS-LODGETICKETS initialized

Initialized 4 payment provider(s)

=== STARTING ENHANCED PAYMENT SYNC ===
Processing workflow:
1. Import payment to import_payments (with field transformation)
2. Fetch order/customer for Square payments
3. Find registration in Supabase
4. Update with charge ID for Stripe
5. Import to import_registrations (with field transformation)
6. Import attendees to import_attendees
7. Import tickets to import_tickets
8. Import contacts to import_contacts with deduplication
9. Process booking contact as customer with registration metadata
9. Selective sync to production collections based on field comparison

âœ“ Connected to MongoDB:
  Cluster: LodgeTix-migration-test-1
  Database: lodgetix
  URI: mongodb+srv:****@lodgetix-migration-test.wydwfu6.mongodb.net/lodgetix?retryWrites=true&w=majority&appName=LodgeTix-migration-test-1

â”â”â” Processing Square â”â”â”

Fetching ALL historical Square payments (one at a time)...
  Fetched payment 1 (cursor: none)

ğŸ“ Processing Square payment: 5WZURjeHRtZKVpza9ECnKKz2R6cZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 2 (cursor: provided)

ğŸ“ Processing Square payment: 5GXVymBC3x18occbL5IXfi34knaZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 3 (cursor: provided)

ğŸ“ Processing Square payment: 37uzagXg6306GrJSUUf574HvB0CZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 4 (cursor: provided)

ğŸ“ Processing Square payment: jtwvvCSh0dwASWgUW1TAfF2l635YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 5 (cursor: provided)

ğŸ“ Processing Square payment: 7nHbZYYBn7M1thYdSmgNo9n28yKZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 6 (cursor: provided)

ğŸ“ Processing Square payment: p4g7czFGnXbMPrHYOtWSnqCieZLZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 7 (cursor: provided)

ğŸ“ Processing Square payment: JOBqwBmraQ1ECS1fVhtdy55ZrrMZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 8 (cursor: provided)

ğŸ“ Processing Square payment: bHpqGQWwCK6aDNnbhv6ChzltfedZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 9 (cursor: provided)

ğŸ“ Processing Square payment: TFOQEKkW2rQS4WHUBdIjyoSj0EJZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 10 (cursor: provided)

ğŸ“ Processing Square payment: ZGvLjl0ZA3MT9vf33jacwBNG5ycZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 11 (cursor: provided)

ğŸ“ Processing Square payment: h8gN46mZTfnGV8xDOWY7q4nnsVPZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 12 (cursor: provided)

ğŸ“ Processing Square payment: NQtKfWQJ2pMEfWLqgqbhTOSQVgeZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 13 (cursor: provided)

ğŸ“ Processing Square payment: 3l9mbrzU72IPMJ1vscl47aM5EzeZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 14 (cursor: provided)

ğŸ“ Processing Square payment: jfPss6uLfMf6Sy8Z7WtPH9FLERKZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 15 (cursor: provided)

ğŸ“ Processing Square payment: VaU4RCrbBAky4Jpe4pvV1GBwRSJZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 16 (cursor: provided)

ğŸ“ Processing Square payment: T1AjRFv4v2jHjyoHPOvHp3jF2BJZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 17 (cursor: provided)

ğŸ“ Processing Square payment: DLDhRUZVwCaYfLXVguPIa7c2TBTZY
  ğŸ“¥ Importing non-completed payment - status: FAILED (will not move to production)
  ğŸ”„ Payment has been updated - cleaning up and reprocessing
  ğŸ§¹ Checking for stale error_payments records for payment: DLDhRUZVwCaYfLXVguPIa7c2TBTZY
  ğŸ›’ Fetching order: jWwz7Uxidz4PeSLPg918oz0X3wXZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: 6AV409Q89NWNMCVYXM82HSX4RM
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  ğŸ“ No registration found for payment: DLDhRUZVwCaYfLXVguPIa7c2TBTZY
  âœ“ Updated import_payments with registrationId: no-match
  â„¹ï¸ FAILED payment - no match is not an error
  Got cursor for next payment
  Fetched payment 18 (cursor: provided)

ğŸ“ Processing Square payment: jhU6YnfsNom1Wu5UEwTpuTUOfkbZY
  ğŸ“¥ Importing non-completed payment - status: FAILED (will not move to production)
  ğŸ”„ Payment has been updated - cleaning up and reprocessing
  ğŸ§¹ Checking for stale error_payments records for payment: jhU6YnfsNom1Wu5UEwTpuTUOfkbZY
  ğŸ›’ Fetching order: lRHUbFrVLiFaXJ7gCrKirTsbMfJZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: 6AV409Q89NWNMCVYXM82HSX4RM
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  ğŸ“ No registration found for payment: jhU6YnfsNom1Wu5UEwTpuTUOfkbZY
  âœ“ Updated import_payments with registrationId: no-match
  â„¹ï¸ FAILED payment - no match is not an error
  Got cursor for next payment
  Fetched payment 19 (cursor: provided)

ğŸ“ Processing Square payment: ByHBzneYeEzSiok0AlGqi7v7N6NZY
  ğŸ“¥ Importing non-completed payment - status: FAILED (will not move to production)
  ğŸ”„ Payment has been updated - cleaning up and reprocessing
  ğŸ§¹ Checking for stale error_payments records for payment: ByHBzneYeEzSiok0AlGqi7v7N6NZY
  ğŸ›’ Fetching order: JXP7Z0ckjqFu5oTSv7OudCIjzFRZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: 6AV409Q89NWNMCVYXM82HSX4RM
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  ğŸ“ No registration found for payment: ByHBzneYeEzSiok0AlGqi7v7N6NZY
  âœ“ Updated import_payments with registrationId: no-match
  â„¹ï¸ FAILED payment - no match is not an error
  Got cursor for next payment
  Fetched payment 20 (cursor: provided)

ğŸ“ Processing Square payment: hmHkLkSEY6gu1Nngf1LYIBaLnPJZY
  ğŸ“¥ Importing non-completed payment - status: FAILED (will not move to production)
  ğŸ”„ Payment has been updated - cleaning up and reprocessing
  ğŸ§¹ Checking for stale error_payments records for payment: hmHkLkSEY6gu1Nngf1LYIBaLnPJZY
  ğŸ›’ Fetching order: hdkX92qVGPjrnucp472nFPOFO9CZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: 6AV409Q89NWNMCVYXM82HSX4RM
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  ğŸ“ No registration found for payment: hmHkLkSEY6gu1Nngf1LYIBaLnPJZY
  âœ“ Updated import_payments with registrationId: no-match
  â„¹ï¸ FAILED payment - no match is not an error
  Got cursor for next payment
  Fetched payment 21 (cursor: provided)

ğŸ“ Processing Square payment: zNueSiS1Y3GP59FJH7A62k4tMrTZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 22 (cursor: provided)

ğŸ“ Processing Square payment: r9ACcx4DHuxDspPsS8xlhWFWKk7YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 23 (cursor: provided)

ğŸ“ Processing Square payment: BYKXKLGaomF5fqksWnC2BDShYz9YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 24 (cursor: provided)

ğŸ“ Processing Square payment: H7MsmC9fLnNjwZCB50pm6oUhDZCZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 25 (cursor: provided)

ğŸ“ Processing Square payment: Xbs2Q3X1vEvZJnSLSnrbaOF4z1EZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 26 (cursor: provided)

ğŸ“ Processing Square payment: 1iYmmAImrRvMZ9FE839tL7f6ZJDZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 27 (cursor: provided)

ğŸ“ Processing Square payment: LHxGj2N2xehd2SVPRgahL09Z4bOZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 28 (cursor: provided)

ğŸ“ Processing Square payment: HnMhwDtTEYP9hcTF0UHH7Y8UTbBZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 29 (cursor: provided)

ğŸ“ Processing Square payment: 3tJyXZgwjgLBCHoyV2uARwGBswdZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 30 (cursor: provided)

ğŸ“ Processing Square payment: vlvOb3ZJBzQJ0XzoCOOCm3lVn2VZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 31 (cursor: provided)

ğŸ“ Processing Square payment: F8t2nIaFgyXCsaClrIb76CGn5fKZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 32 (cursor: provided)

ğŸ“ Processing Square payment: DbJ0DmwrCW68Xy80jcjBhSu1TSTZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 33 (cursor: provided)

ğŸ“ Processing Square payment: 3ZJ3HBSr4UdPafNCaBainy55wc7YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 34 (cursor: provided)

ğŸ“ Processing Square payment: XZvsmRdAo7cOcbytf8tXyQopLI6YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 35 (cursor: provided)

ğŸ“ Processing Square payment: lqOt4jZnIiTTlE97PDYCV3tShsPZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 36 (cursor: provided)

ğŸ“ Processing Square payment: zVoh8VCpVfGVFHDPCb6tQiG9uJ8YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 37 (cursor: provided)

ğŸ“ Processing Square payment: ZggJj2u2p8iwhRWOajCzg0zZ2YEZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 38 (cursor: provided)

ğŸ“ Processing Square payment: jjZo8QIRaYRVHjWEF6kGT2A8SqYZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 39 (cursor: provided)

ğŸ“ Processing Square payment: XbYcqGOlLYy34w8GRh6oDKYqSKKZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 40 (cursor: provided)

ğŸ“ Processing Square payment: xECGubABWxwHhK8cYuzZJdzEfONZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 41 (cursor: provided)

ğŸ“ Processing Square payment: xSlYUjRPlvBqdFASpTgzxyAq1RHZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 42 (cursor: provided)

ğŸ“ Processing Square payment: 7NcA5XmQQnii5C4wyZ49VRv4O6bZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 43 (cursor: provided)

ğŸ“ Processing Square payment: jXbMStnAmtjde3RrcJyeFi1fUuRZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 44 (cursor: provided)

ğŸ“ Processing Square payment: NkToF5EmmRnVVpX6UAqwfq6nBLNZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 45 (cursor: provided)

ğŸ“ Processing Square payment: 3zOzdaBQtF8P6LmaVkIriaGTYKeZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 46 (cursor: provided)

ğŸ“ Processing Square payment: LZkdOfjFmPKMhwgBnK0HTv3arvJZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 47 (cursor: provided)

ğŸ“ Processing Square payment: 9Q1czaAuSZ3MLpRIjWwQ5qK8LlOZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 48 (cursor: provided)

ğŸ“ Processing Square payment: bX925MCTlcedZE16Y5isSOiOY47YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 49 (cursor: provided)

ğŸ“ Processing Square payment: TFQpQg9T6EMRNsVMCRqzqF9mg1WZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 50 (cursor: provided)

ğŸ“ Processing Square payment: ZAMti0WeQC6bzau6xzcwAt5brqKZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 51 (cursor: provided)

ğŸ“ Processing Square payment: NgzFLVSyeKvPqooHJ4eqTIp0k0KZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 52 (cursor: provided)

ğŸ“ Processing Square payment: vH42rszQNFswJ7wiC9myBYYRVSUZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 53 (cursor: provided)

ğŸ“ Processing Square payment: J88iNwjm7wF9AcNLYNHXedPYbo6YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 54 (cursor: provided)

ğŸ“ Processing Square payment: RC5yWMBETbgS58lLWRMWrtwEzD9YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 55 (cursor: provided)

ğŸ“ Processing Square payment: tWs6GU9fkOLQyYgcvz6V9Le0mAdZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 56 (cursor: provided)

ğŸ“ Processing Square payment: FgpZ0BTR7kELg8mqty50XffR9TPZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 57 (cursor: provided)

ğŸ“ Processing Square payment: zrVcZLjCpVPZwvQrkA8GIZTrVS9YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 58 (cursor: provided)

ğŸ“ Processing Square payment: NaIV57IiGy496z8NvR7Z5Mc17SZZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 59 (cursor: provided)

ğŸ“ Processing Square payment: 12Y9un9kSKeqSxMjwcNTefoysTEZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 60 (cursor: provided)

ğŸ“ Processing Square payment: rJSoyuFWlC5k0S5hOxIyksf0pH9YY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
  Fetched payment 61 (cursor: provided)

ğŸ“ Processing Square payment: Rc8t4dVR4bflbR2WdcWFR22XtNSZY
  âœ… Importing completed payment - status: COMPLETED
  âœ“ Payment already exists in production - skipping
  Got cursor for next payment
