=== ENHANCED PAYMENT SYNC LOG ===
Started at: 2025-08-14T13:52:34.650Z
Processing Square with orders/customers and contacts

âœ“ Supabase client initialized
âœ“ Square provider initialized (REQUIRED)
âœ“ DA-LODGETIX initialized
âœ“ WS-LODGETIX initialized
âœ“ WS-LODGETICKETS initialized

Initialized 4 payment provider(s)

=== STARTING ENHANCED PAYMENT SYNC ===
Processing workflow:
1. Import payment to import_payments (with field transformation)
2. Fetch order/customer for Square payments
3. Find registration in Supabase
4. Update with charge ID for Stripe
5. Import to import_registrations (with field transformation)
6. Import attendees to import_attendees
7. Import tickets to import_tickets
8. Import contacts to import_contacts with deduplication
9. Process booking contact as customer with registration metadata
9. Selective sync to production collections based on field comparison

âœ“ Connected to MongoDB:
  Cluster: LodgeTix-migration-test-1
  Database: lodgetix
  URI: mongodb+srv:****@lodgetix-migration-test.wydwfu6.mongodb.net/lodgetix?retryWrites=true&w=majority&appName=LodgeTix-migration-test-1

â”â”â” Processing Square â”â”â”

Fetching ALL historical Square payments (one at a time)...
  Fetched payment 1 (cursor: none)

ğŸ“ Processing Square payment: p4g7czFGnXbMPrHYOtWSnqCieZLZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 2 (cursor: provided)

ğŸ“ Processing Square payment: JOBqwBmraQ1ECS1fVhtdy55ZrrMZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 3 (cursor: provided)

ğŸ“ Processing Square payment: bHpqGQWwCK6aDNnbhv6ChzltfedZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 4 (cursor: provided)

ğŸ“ Processing Square payment: TFOQEKkW2rQS4WHUBdIjyoSj0EJZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 5 (cursor: provided)

ğŸ“ Processing Square payment: ZGvLjl0ZA3MT9vf33jacwBNG5ycZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 6 (cursor: provided)

ğŸ“ Processing Square payment: h8gN46mZTfnGV8xDOWY7q4nnsVPZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 7 (cursor: provided)

ğŸ“ Processing Square payment: NQtKfWQJ2pMEfWLqgqbhTOSQVgeZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 8 (cursor: provided)

ğŸ“ Processing Square payment: 3l9mbrzU72IPMJ1vscl47aM5EzeZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 9 (cursor: provided)

ğŸ“ Processing Square payment: jfPss6uLfMf6Sy8Z7WtPH9FLERKZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 10 (cursor: provided)

ğŸ“ Processing Square payment: VaU4RCrbBAky4Jpe4pvV1GBwRSJZY
  â­ï¸ Already imported - skipping
  Got cursor for next payment
  Fetched payment 11 (cursor: provided)

ğŸ“ Processing Square payment: T1AjRFv4v2jHjyoHPOvHp3jF2BJZY
  ğŸ›’ Fetching order: tj4l17DY50XOIO1kKNYMDWOZK8FZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: KF1GGP49BFENFBS1JBT51PV82G
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: d9bc7cb7-31c1-4a13-8a92-c293f3d1cf63
  âœ“ Updated import_payments with registrationId: d9bc7cb7-31c1-4a13-8a92-c293f3d1cf63
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Gustavo Fiestas
    âœ“ Created new customer: Gustavo Fiestas
    âœ“ Updated registration with customer ObjectId
    Extracting 1 attendees from registration_data
  âœ“ Found 1 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 5 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Gustavo Fiestas
  âœ… Completed processing Square payment T1AjRFv4v2jHjyoHPOvHp3jF2BJZY
  Got cursor for next payment
  Fetched payment 12 (cursor: provided)

ğŸ“ Processing Square payment: DLDhRUZVwCaYfLXVguPIa7c2TBTZY
  â­ï¸ Skipping - status: FAILED
  Got cursor for next payment
  Fetched payment 13 (cursor: provided)

ğŸ“ Processing Square payment: jhU6YnfsNom1Wu5UEwTpuTUOfkbZY
  â­ï¸ Skipping - status: FAILED
  Got cursor for next payment
  Fetched payment 14 (cursor: provided)

ğŸ“ Processing Square payment: ByHBzneYeEzSiok0AlGqi7v7N6NZY
  â­ï¸ Skipping - status: FAILED
  Got cursor for next payment
  Fetched payment 15 (cursor: provided)

ğŸ“ Processing Square payment: hmHkLkSEY6gu1Nngf1LYIBaLnPJZY
  â­ï¸ Skipping - status: FAILED
  Got cursor for next payment
  Fetched payment 16 (cursor: provided)

ğŸ“ Processing Square payment: zNueSiS1Y3GP59FJH7A62k4tMrTZY
  ğŸ›’ Fetching order: Z58Ht3g5mkYiMQhTmacmMT1Ala8YY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: H2TBDHAN3T930V4GB1TGQX8C1C
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: 2d56701e-263f-4d25-b037-6a77e4e56b7b
  âœ“ Updated import_payments with registrationId: 2d56701e-263f-4d25-b037-6a77e4e56b7b
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Blake Ritchie
    âœ“ Created new customer: Blake Ritchie
    âœ“ Updated registration with customer ObjectId
    Extracting 1 attendees from registration_data
  âœ“ Found 1 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 1 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Blake Ritchie
  âœ… Completed processing Square payment zNueSiS1Y3GP59FJH7A62k4tMrTZY
  Got cursor for next payment
  Fetched payment 17 (cursor: provided)

ğŸ“ Processing Square payment: r9ACcx4DHuxDspPsS8xlhWFWKk7YY
  ğŸ›’ Fetching order: LOQIEp0fpoo284GW6rJFN4AF1UDZY
    âœ“ Order fetched
  ğŸ‘¤ Fetching customer: HTPP5EW2G6NDF4QS1TM5J7JBH8
    âœ“ Customer fetched
  âœ“ Imported to import_payments with field transformation
  âœ“ Found registration: fc71d5ec-a70d-4874-86d1-ef1e2c05d162
  âœ“ Updated import_payments with registrationId: fc71d5ec-a70d-4874-86d1-ef1e2c05d162
  âœ“ Imported FULL registration to import_registrations with field transformation
  â¸ï¸ Production sync deferred to selective sync phase
  ğŸ“ Processing booking contact as customer
    Customer data created: Conrad Hermosura
    âœ“ Created new customer: Conrad Hermosura
    âœ“ Updated registration with customer ObjectId
    Extracting 2 attendees from registration_data
  âœ“ Found 2 attendee(s)
    âš ï¸ No tickets in registration_data, checking Supabase tickets table
  âœ“ Found 2 ticket(s) in registration
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    ğŸ’¾ Saving ticket to import_tickets: undefined (Unknown Event, qty: 1)
      ğŸ”„ Updated ticket document
    âœ“ Processed contact: Conrad Hermosura
    âœ“ Processed contact: Divina  Hermosura
  âœ… Completed processing Square payment r9ACcx4DHuxDspPsS8xlhWFWKk7YY
  Got cursor for next payment
  Fetched payment 18 (cursor: provided)

ğŸ“ Processing Square payment: BYKXKLGaomF5fqksWnC2BDShYz9YY
